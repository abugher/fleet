---
- hosts:                synapse
  name:                 'configure ssh on synapse'
  gather_facts:         False
  remote_user:          ansible
  become:               yes
  become_method:        sudo
  tasks:

  - name:               'user root:  id_rsa'
    copy:
      src:              '~/code/sensitive/conf/ssh_keys/root@synapse.id_rsa'
      dest:             '/root/.ssh/id_rsa'
      owner:            'root'
      group:            'root'
      mode:             '0600'

  - name:               'user root:  id_rsa.pub'
    copy:
      src:              '~/code/fleet/conf/ssh_keys/root@synapse.id_rsa.pub'
      dest:             '/root/.ssh/id_rsa.pub'
      owner:            'root'
      group:            'root'
      mode:             '0644'

  - name:               'user nagios:  id_rsa'
    copy:
      src:              '~/code/sensitive/conf/ssh_keys/nagios@synapse.id_rsa'
      dest:             '~nagios/.ssh/id_rsa'
      owner:            'nagios'
      group:            'nagios'
      mode:             '0600'

  - name:               'user nagios:  id_rsa.pub'
    copy:
      src:              '~/code/fleet/conf/ssh_keys/nagios@synapse.id_rsa.pub'
      dest:             '~nagios/.ssh/id_rsa.pub'
      owner:            'nagios'
      group:            'nagios'
      mode:             '0644'

  - name:               'user nagios:  known_hosts'
    copy:
      src:              '~/code/fleet/conf/ssh_keys/nagios@synapse.known_hosts'
      dest:             '~nagios/.ssh/known_hosts'
      owner:            'nagios'
      group:            'nagios'
      mode:             '0600'

  - name:               'user escrow:  authorize keys'
    authorized_key:
      user:             'escrow'
      key:              "{{ item }}"
    with_file:
      - "~/code/fleet/conf/ssh_keys/root@neuron.id_rsa.pub"
  - name:               'user pi:  authorize keys'
    authorized_key:
      user:             'pi'
      key:              "{{ item }}"
    with_file:
      - "~/code/fleet/conf/ssh_keys/aaron-phone@aaron-phone.id_rsa.pub"
  - name:               'user pi:  install private key'
    copy:
      src:              '~/code/sensitive/conf/ssh_keys/pi@synapse.id_rsa'
      dest:             '~pi/.ssh/id_rsa'
      owner:            'pi'
      group:            'pi'
      mode:             '0600'
  - name:               'user pi:  install public key'
    copy:
      src:              '~/code/fleet/conf/ssh_keys/pi@synapse.id_rsa.pub'
      dest:             '~pi/.ssh/id_rsa.pub'
      owner:            'pi'
      group:            'pi'
      mode:             '0644'
