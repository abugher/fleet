---
install_packages:
  - 'dnsmasq'
install_files:
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "roles/{{ inventory_hostname }}/files/conf/dnsmasq.conf"
    dest:               '/etc/dnsmasq.conf'
    # /etc/hosts on neuron-mail will always get changed by update_dns_phase2.  It would be cleaner to initialize the file by running 'update_dns_phase2 $(dig +short myip.opendns.com @resolver1.opendns.com)', and simply set changes=false.  The script runs every ten minutes anyway; running an extra time won't hurt.
    # But that's just for neuron-mail.  neuron just needs to get that list of hosts.
    # The dnsmasq role needs to be forked and merged.  One copy in update_dns_phase1, and one modified copy in update_dns_phase2.  Those roles can be renamed to dns1 and dns2, or similar.
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "roles/{{ inventory_hostname }}/files/conf/hosts"
    dest:               '/etc/hosts'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "roles/{{ inventory_hostname }}/files/conf/default.dnsmasq"
    dest:               '/etc/default/dnsmasq'
enable_services:
  - 'dnsmasq'
start_services:
  - 'dnsmasq'
restart_services:
  - 'dnsmasq'
