#!/bin/bash

read neuronpointer_ip < /etc/neuronpointer.net

ip_regex='^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$'

if echo neuronpointer_ip | grep -qE $ip_regex; then
  if ! grep -qF ' neuronpointer.net' /etc/hosts; then
    echo ' neuronpointer.net' >> /etc/hosts
  fi

  ! grep -qF "${neuronpointer_ip} neuronpointer.net" /etc/hosts \
  && sed \
    -i -E \
    's/.* neuronpointer\.net$/'$neuronpointer_ip' neuronpointer\.net/' \
    /etc/hosts \
  && service dnsmasq force-reload

  ! grep -qF "address=/.neuronpointer.net/neuronpointer.net/${neuronpointer_ip}" /etc/dnsmasq.conf \
  && sed \
    -i -E \
    's/^address=\/.neuronpointer\.net\/neuronpointer\.net\/[0-9.]*$/address=\/.neuronpointer.net\/neuronpointer.net\/'$neuronpointer_ip'/' \
    /etc/dnsmasq.conf \
  && service dnsmasq restart
fi

