---
- hosts:                meliora
  name:                 'configure ssh on meliora'
  gather_facts:         False
  remote_user:          ansible
  become:               yes
  become_method:        sudo
  vars:
    keys:
      - user:           'rachel'
        keyfile:        '~/code/fleet/conf/ssh_keys/aaron-phone@aaron-phone.id_rsa.pub'
      - user:           'rachel'
        keyfile:        '~/code/fleet/conf/ssh_keys/aaron@mawg.id_rsa.pub'
      - user:           'rachel'
        keyfile:        '~/code/fleet/conf/ssh_keys/rachel@rudolph.id_rsa.pub'
      - user:           'rachel'
        keyfile:        '~/code/fleet/conf/ssh_keys/rachel@meliora.id_rsa.pub'
      - user:           'aaron'
        keyfile:        '~/code/fleet/conf/ssh_keys/aaron-phone@aaron-phone.id_rsa.pub'
      - user:           'aaron'
        keyfile:        '~/code/fleet/conf/ssh_keys/aaron@mawg.id_rsa.pub'
      - user:           'aaron'
        keyfile:        '~/code/fleet/conf/ssh_keys/aaron@meliora.id_rsa.pub'
  tasks:

  - include:            'tasks/authorized_keys.yml'

  - name:               'user rachel:  .ssh'
    file:
      path:             '~rachel/.ssh'
      state:            'directory'
      owner:            'rachel'
      group:            'rachel'
      mode:             '0750'

  - name:               'user rachel:  known_hosts'
    copy:
      src:              '~/code/fleet/conf/ssh_keys/rachel@meliora.known_hosts'
      dest:             '~rachel/.ssh/known_hosts'
      owner:            'rachel'
      group:            'rachel'
      mode:             '0600'

  - name:               'user rachel:  id_rsa'
    copy:
      src:              '~/code/sensitive/conf/ssh_keys/rachel@meliora.id_rsa'
      dest:             '~rachel/.ssh/id_rsa'
      owner:            'rachel'
      group:            'rachel'
      mode:             '0600'

  - name:               'user aaron:  .ssh'
    file:
      path:             '~aaron/.ssh'
      state:            'directory'
      owner:            'aaron'
      group:            'aaron'
      mode:             '0750'

  - name:               'user aaron:  known_hosts'
    copy:
      src:              '~/code/fleet/conf/ssh_keys/aaron@meliora.known_hosts'
      dest:             '~aaron/.ssh/known_hosts'
      owner:            'aaron'
      group:            'aaron'
      mode:             '0600'

  - name:               'user aaron:  id_rsa'
    copy:
      src:              '~/code/sensitive/conf/ssh_keys/aaron@meliora.id_rsa'
      dest:             '~aaron/.ssh/id_rsa'
      owner:            'aaron'
      group:            'aaron'
      mode:             '0600'

