---
- hosts:                synapse
  name:                 'configure krb5 KDC on synapse'
  gather_facts:         False
  remote_user:          ansible
  become:               yes
  become_method:        sudo
  vars_files:           
    - '~/code/sensitive/playbooks/configure_kdc_db_master_key.yml'
  tasks:

  - name:               'create realm'
    shell:              /bin/echo -e "{{ kdc_db_master_key_twice }}" | /usr/sbin/krb5_newrealm
    args:
      creates:          '/etc/krb5kdc/principal'
  - name:               'set ACL'
    copy:
      src:              '~/code/fleet/conf/kerberos/kadm5.acl'
      dest:             '/etc/krb5kdc/kadm5.acl'
