---
- hosts:                neuron
  name:                 'configure apt on neuron'
  gather_facts:         False
  remote_user:          ansible
  become:               yes
  become_method:        sudo
  tasks:

  - name:               'sources.list'
    copy:
      src:              '~/code/fleet/conf/apt/neuron/sources.list'
      dest:             '/etc/apt/sources.list'
      owner:            'root'
      group:            'root'
      mode:             '0644'
    register:           apt_sources_neuron
  - name:               'policy-rc.d'
    copy:
      src:              '~/code/fleet/conf/apt/neuron/policy-rc.d'
      dest:             '/usr/sbin/policy-rc.d'
      owner:            'root'
      group:            'root'
      mode:             '0755'
    register:           apt_policyrcd_neuron
  - name:               'raspi.list'
    copy:
      src:              '~/code/fleet/conf/apt/neuron/raspi.list'
      dest:             '/etc/apt/sources.list.d/raspi.list'
      owner:            'root'
      group:            'root'
      mode:             '0644'
    register:           apt_sources_raspi_neuron
  - name:               'remove collabora.list'
    file:
      path:             '/etc/apt/sources.list.d/collabora.list'
      state:            'absent'
    register:           apt_sources_collabora_neuron
  - name:               'update apt'
    apt:
      update_cache:     'yes'
    when:               apt_sources_neuron.changed or apt_policyrcd_neuron.changed or apt_sources_raspi_neuron.changed or apt_sources_collabora_neuron.changed
