#!/bin/bash

# DISTRIBUTED BY ANSIBLE

# update_python_packages
#
# requires package python-pip and probably python-dev
#
# I formerly used the --no-cache-dir argument to pip because that somehow
# lowers memory requirements.  Otherwise the Pi's fail sometimes.
#
# Updated the Pi's to Jessie, and now neuron is failing updates because it's
# never heard of --no-cache-dir.  Hopefully it doesn't need it.  Removing.

for p in $(
  pip freeze --local \
    | grep -vE '^\-e|^#' \
    | cut -d = -f 1 
); do 
  pip install -U $p || {
    echo -e "ERROR:  Failed to upgrade ${p}." >&2
    exit 1
  }
  echo "${p}"
done

# flexget 1.2.351 requires guessit<0.10.4,>=0.9.3.  Current latest guessit
# is 0.11.0.  The updates above always leave flexget broken.  This crude
# hack fixes it.  --Aaron 2015-09-16
if test 'neuron' = $HOSTNAME; then
  pip install -U FlexGet
fi

# I had to do this once.  *shrug*  I got the idea from here:
#   http://stackoverflow.com/questions/28987891/patch-pyopenssl-for-sslv3-issue
#
# sudo easy_install --upgrade pip
