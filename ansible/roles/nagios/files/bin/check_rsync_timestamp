#!/bin/bash

timestamp="$(/usr/local/bin/agent_command "${1}" rsync_timestamp)"
timestamp_hr="$(date -d "@${timestamp}")"
now="$(date +%s)"
delta="$(( ${now} - ${timestamp} ))"

if test ${timestamp} -gt ${now}; then
  echo "Timestamp is in the future:  ${timestamp_hr}"
  exit 2
elif test ${delta} -gt $(( 60 * 60 * 24 * 2 )); then
  echo "Timestamp is more than two days old:  ${timestamp_hr}"
  exit 2
else
  echo "Timestamp is less than two days old:  ${timestamp_hr}"
fi

