---
# Use allow_users as defined in host_vars.
restart_services:
  - 'ssh'
install_files:
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/../{{ inventory_hostname }}/files/ssh_keys/ssh_host_rsa_key.pub"
    dest:               '/etc/ssh/ssh_host_rsa_key.pub'
  - owner:              'root'
    group:              'root'
    mode:               '0600'
    src:                "{{ role_path }}/../../../../sensitive/ansible/roles/{{ inventory_hostname }}/files/ssh_keys/ssh_host_rsa_key"
    dest:               '/etc/ssh/ssh_host_rsa_key'
lines_in_files:
  - dest:               '/etc/ssh/sshd_config'
    line:               'Banner                          /etc/banner.txt'
    regexp:             '^Banner '
  - dest:               '/etc/ssh/sshd_config'
    line:               'ChallengeResponseAuthentication no'
    regexp:             '^ChallengeResponseAuthentication '
  - dest:               '/etc/ssh/sshd_config'
    line:               'GSSAPIAuthentication            no'
    regexp:             '^GSSAPIAuthentication '
  - dest:               '/etc/ssh/sshd_config'
    line:               'HostKey                         /etc/ssh/ssh_host_rsa_key'
    regexp:             '^HostKey '
  - dest:               '/etc/ssh/sshd_config'
    line:               'HostbasedAuthentication         no'
    regexp:             '^HostbasedAuthentication '
  - dest:               '/etc/ssh/sshd_config'
    line:               'IgnoreRhosts                    yes'
    regexp:             '^IgnoreRhosts '
  - dest:               '/etc/ssh/sshd_config'
    line:               'LogLevel                        INFO'
    regexp:             '^LogLevel '
  - dest:               '/etc/ssh/sshd_config'
    line:               'LoginGraceTime                  120'
    regexp:             '^LoginGraceTime '
  - dest:               '/etc/ssh/sshd_config'
    line:               'PermitEmptyPasswords            no'
    regexp:             '^PermitEmptyPasswords '
  - dest:               '/etc/ssh/sshd_config'
    line:               'PermitRootLogin                 no'
    regexp:             '^PermitRootLogin '
  - dest:               '/etc/ssh/sshd_config'
    line:               'Port                            22'
    regexp:             '^Port '
  - dest:               '/etc/ssh/sshd_config'
    line:               'PrintLastLog                    no'
    regexp:             '^PrintLastLog '
  - dest:               '/etc/ssh/sshd_config'
    line:               'PrintMotd                       no'
    regexp:             '^PrintMotd '
  - dest:               '/etc/ssh/sshd_config'
    line:               'Protocol                        2'
    regexp:             '^Protocol '
  - dest:               '/etc/ssh/sshd_config'
    line:               'PubkeyAuthentication            yes'
    regexp:             '^PubkeyAuthentication '
  - dest:               '/etc/ssh/sshd_config'
    line:               'RSAAuthentication               yes'
    regexp:             '^RSAAuthentication '
  - dest:               '/etc/ssh/sshd_config'
    line:               'RhostsRSAAuthentication         no'
    regexp:             '^RhostsRSAAuthentication '
  - dest:               '/etc/ssh/sshd_config'
    line:               'StrictModes                     yes'
    regexp:             '^StrictModes '
  - dest:               '/etc/ssh/sshd_config'
    line:               'Subsystem sftp                  internal-sftp'
    regexp:             '^Subsystem sftp '
  - dest:               '/etc/ssh/sshd_config'
    line:               'SyslogFacility                  AUTH'
    regexp:             '^SyslogFacility '
  - dest:               '/etc/ssh/sshd_config'
    line:               'ClientAliveInterval             15'
    regexp:             '^ClientAliveInterval '
  - dest:               '/etc/ssh/sshd_config'
    line:               'ClientAliveCountMax             2'
    regexp:             '^ClientAliveCountMax '
  - dest:               '/etc/ssh/sshd_config'
    line:               'UsePAM                          yes'
    regexp:             '^UsePAM '
  - dest:               '/etc/ssh/sshd_config'
    line:               'UsePrivilegeSeparation          yes'
    regexp:             '^UsePrivilegeSeparation '
  - dest:               '/etc/ssh/sshd_config'
    line:               'X11DisplayOffset                10'
    regexp:             '^X11DisplayOffset '
  - dest:               '/etc/ssh/sshd_config'
    line:               'X11Forwarding                   yes'
    regexp:             '^X11Forwarding '
  - dest:               '/etc/ssh/sshd_config'
    line:               'X11UseLocalhost                 no'
    regexp:             '^X11UseLocalhost '
